<!--edit_paragraph.html-->

{% extends "base.html" %}

{% block container %}
{% from "macros/edit_sentence_buttons.html" import control_buttons, info_icons %}
{% from "macros/all_popups.html" import buffer_popup, unlink_group_popup, sentence_popup %}
{% from "macros/editor_checkboxes.html" import editor_checkboxes%}
{{ super() }}

<input type="hidden" id="csrf_token" name="csrf_token" value="{{ csrf_token() }}">

<div class="flex">
    <button class="btn " id="backToReportButton" type="button">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ø—Ä–æ—Ç–æ–∫–æ–ª–∞</button>
</div>

<div class="container edit-paragraph" id="editParagraphContainer" data-report-id="{{ report_id }}" data-report-type="{{report_type}}" data-paragraph-id="{{ paragraph.id }}">

    <!-- –î–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞ -->
    <div class="flex edit-paragraph__paragraph-data-block">
        <div class="flex edit-paragraph__paragraph-data">
            <div>
                <label for="paragraph_id">ID:</label>
                <span name="paragraph_id">{{ paragraph.id }}</span>
            </div>
            <div>
                <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
                <input type="text" id="paragraph_comment" value="{{ paragraph.paragraph_comment }}" class="input">
            </div>
            <div>
                <label>–í–µ—Å:</label>
                <input type="number" id="paragraph_weight" value="{{ paragraph.paragraph_weight }}" class="input">
            </div>
           
        </div>

        <!-- –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ -->
        {{editor_checkboxes(user_settings)}}

        <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
        <button class="btn  edit-paragraph__btn--save-paragraph-data" id="saveParagraphDataButton">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –≤—ã–∑–æ–≤–∞ –ø–æ–ø–∞–ø–∞ –±—É—Ñ–µ—Ä–∞ -->
        <button type="button" id="openBufferPopupButton" class="btn btn-icon btn-open-buffer" title="–û—Ç–∫—Ä—ã—Ç—å –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞">
            üìã –ë—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
        </button>
    </div>
    <input type="text" id="sentenceSearch" class="input" placeholder="üîç –ù–∞–π—Ç–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ...">
    <hr>

    <!-- –ì–ª–∞–≤–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è -->
    <div class="flex edit-sentence__title-wrapper" 
        id="editSentenceTitleHead" 
        data-group-is-linked="{{ paragraph.has_linked_head }}" 
        data-sentence-type="head"
        data-group-id="{{ paragraph.head_sentence_group_id }}"
        data-related-id="{{ paragraph.id }}"
        >
        <h3 class="edit-sentence__title">–ì–ª–∞–≤–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</h3>
        {% if paragraph.has_linked_head %}
            <span class="edit-sentence__title-span">üîí</span>
        {% endif %}
        
    </div>
    <ul class="edit-sentence__list"
        id="editHeadSentenceList"
        data-paragraph-id="{{ paragraph.id }}"
        data-locked="{{ 'True' if paragraph.has_linked_head else 'False' }}"
        >
        {% if paragraph.head_sentences %}
            {% for sentence in paragraph.head_sentences %}
                <li class="wrapper__card edit-sentence__item edit-sentence__item--head 
                    {% if sentence.body_sentences %}
                        wrapper__card--text
                    {% endif %}
                    " 
                data-sentence-id="{{ sentence.id }}"
                data-paragraph-id="{{ paragraph.id }}"
                data-sentence-index="{{ sentence.sentence_index }}"
                data-sentence-type="head"
                data-sentence-tags="{{ sentence.tags }}"
                data-sentence-comment="{{ sentence.comment }}"
                data-sentence-is-linked="{{ sentence.is_linked }}"
                data-sentence-has-linked-body="{{ sentence.has_linked_body}}"
                data-sentence-group-id="{{ sentence.group_id }}"
                >

                <div class="flex">
                    <div class="drag-handle">‚ò∞</div> <!-- –•–≤–∞—Ç–∞–ª–∫–∞ -->
                    
                    <div>
                        <p class="edit-sentence__text">{{ sentence.sentence }}</p>
                        {% if not sentence.body_sentences %}
                            <p class="edit-paragraph__title--invisible">–£ –¥–∞–Ω–Ω–æ–≥–æ –≥–ª–∞–≤–Ω–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π</p>
                        {% endif %}
                    </div>
                </div>

                <div class="control-buttons__wrapper">
                    <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑ –º–∞–∫—Ä–æ—Å–∞ -->
                    {{ control_buttons(sentence.id, 'sentence', paragraph.id, sentence.sentence, report_type, sentence_type="head", group_id=sentence.group_id) }}
                    <!-- –ë–ª–æ–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∑–Ω–∞—á–∫–æ–≤ –∏–∑ –º–∞–∫—Ä–æ—Å–∞ -->
                    {{ info_icons(sentence.is_linked) }}
                </div>
                
                </li>
            {% endfor %}
        {% else %}
            <p>–£ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞ –ø–æ–∫–∞ –Ω–µ—Ç –≥–ª–∞–≤–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π</p>
        {% endif %}
    </ul>
    <hr>

    <button class="btn " id="addHeadSentenceButton">–î–æ–±–∞–≤–∏—Ç—å –≥–ª–∞–≤–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</button>

    <hr>
    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è -->
    <div class="flex edit-sentence__title-wrapper" 
        id="editSentenceTitleTail" 
        data-group-is-linked="{{ paragraph.has_linked_tail }}" 
        data-sentence-type="tail"
        data-group-id="{{ paragraph.tail_sentence_group_id }}"
        data-related-id="{{ paragraph.id }}"
        >
        <h3 class="edit-sentence__title">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞</h3>
        {% if paragraph.has_linked_tail %}
            <span class="edit-sentence__title-span">üîí</span>
        {% endif %}
    </div>

    <ul class="edit-sentence__list" 
        style="display: block;" 
        id="editTailSentenceList"
        data-paragraph-id="{{ paragraph.id }}"
        data-locked="{{ 'True' if paragraph.has_linked_tail else 'False' }}"
        >
        {% for sentence in paragraph.tail_sentences %}
            <li class="wrapper__card wrapper__card--tail edit-sentence__item edit-sentence__item--tail" 
                data-sentence-id="{{ sentence.id }}"
                data-paragraph-id="{{ paragraph.id }}"
                data-sentence-weight="{{ sentence.sentence_weight }}"
                data-sentence-type="tail"
                data-sentence-tags="{{ sentence.tags }}"
                data-sentence-comment="{{ sentence.comment }}"
                data-sentence-is-linked="{{ sentence.is_linked }}"
                data-sentence-group-id="{{ sentence.group_id }}"
                >

                <div class="flex">
                    <div class="drag-handle"> {{sentence.sentence_weight}}</div>
                    <p class="edit-sentence__text">{{ sentence.sentence }}</p>
                </div>

                <div class="control-buttons__wrapper">
                    <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑ –º–∞–∫—Ä–æ—Å–∞ -->
                    {{ control_buttons(sentence.id, 'sentence', paragraph.id, sentence.sentence, report_type, sentence_type="tail", group_id=sentence.group_id) }}
                    <!-- –ë–ª–æ–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∑–Ω–∞—á–∫–æ–≤ –∏–∑ –º–∞–∫—Ä–æ—Å–∞ -->
                    {{ info_icons(sentence.is_linked) }}
                </div>

            </li>
        {% endfor %}
        <hr>
        <button class="btn " id="addTailSentenceButton">–î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</button>
    </ul>
</div>

<!-- –ü–æ–ø–∞–ø —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ -->
{{ sentence_popup() }}

<!-- –ü–æ–ø–∞–ø –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–≤—è–∑—å—é –≥—Ä—É–ø–ø—ã –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ -->
{{ unlink_group_popup() }}

<!-- –ë—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ (–ø–æ–ø–∞–ø) –∏–∑ –º–∞–∫—Ä–æ—Å–∞ -->
{{ buffer_popup() }}


{% endblock container %}

{% block scripts %}
<script>
    const paragraphData = {{ paragraph | tojson | safe }};
</script>

<script src="{{ url_for('static', filename='js/sentence_buffer.js') }}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<script src="{{ url_for('static', filename='js/edit_paragraph.js') }}"></script>
<script src="{{ url_for('static', filename='js/buffer_popup.js') }}"></script>
{% endblock scripts %}